<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Project_MyShop_2025.Views.ChatbotPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Project_MyShop_2025.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="#F8FAFC">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="White" Padding="24,16" 
                BorderBrush="#E2E8F0" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Left: Title & Status -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16">
                    <!-- AI Avatar -->
                    <Border Width="44" Height="44" CornerRadius="22">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#8B5CF6" Offset="0"/>
                                <GradientStop Color="#EC4899" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <FontIcon Glyph="&#xE8EA;" FontSize="20" Foreground="White" 
                                  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Border>
                    
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="AI Assistant" FontSize="18" FontWeight="SemiBold" Foreground="#0F172A"/>
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <Ellipse Width="8" Height="8" Fill="#22C55E"/>
                            <TextBlock Text="Powered by Gemini" FontSize="12" Foreground="#64748B"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Right: Actions -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
                    <Button x:Name="ClearChatButton" Click="ClearChat_Click"
                            Background="Transparent" BorderThickness="0" 
                            Padding="10" CornerRadius="8"
                            ToolTipService.ToolTip="Clear conversation">
                        <FontIcon Glyph="&#xE74D;" FontSize="16" Foreground="#64748B"/>
                    </Button>
                    <Button x:Name="SettingsButton" Click="Settings_Click"
                            Background="Transparent" BorderThickness="0" 
                            Padding="10" CornerRadius="8"
                            ToolTipService.ToolTip="Settings">
                        <FontIcon Glyph="&#xE713;" FontSize="16" Foreground="#64748B"/>
                        <Button.Flyout>
                            <Flyout Placement="Bottom">
                                <StackPanel Spacing="16" Width="300" Padding="4">
                                    <TextBlock Text="API Settings" FontWeight="SemiBold" FontSize="14" Foreground="#0F172A"/>
                                    <PasswordBox x:Name="ApiKeyBox" Header="Gemini API Key" 
                                             PlaceholderText="Enter your API key..."
                                             PasswordRevealMode="Peek"/>
                                    <Button Content="Save" Click="SaveApiKey_Click" 
                                            HorizontalAlignment="Right"
                                            Background="#8B5CF6" Foreground="White" 
                                            CornerRadius="6" Padding="16,8"/>
                                </StackPanel>
                            </Flyout>
                        </Button.Flyout>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Chat Messages Area -->
        <ScrollViewer x:Name="ChatScrollViewer" Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" Padding="24,16">
            <StackPanel x:Name="MessagesPanel" Spacing="16">
                <!-- Welcome Message -->
                <Border x:Name="WelcomeCard" Background="White" CornerRadius="16" Padding="24" 
                        HorizontalAlignment="Center" MaxWidth="600"
                        BorderBrush="#E2E8F0" BorderThickness="1">
                    <StackPanel Spacing="16" HorizontalAlignment="Center">
                        <!-- Gemini Icon -->
                        <Border Width="64" Height="64" CornerRadius="32" HorizontalAlignment="Center">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#8B5CF6" Offset="0"/>
                                    <GradientStop Color="#EC4899" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <FontIcon Glyph="&#xE8EA;" FontSize="28" Foreground="White" 
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        
                        <TextBlock Text="Hello! I'm your AI Assistant" FontSize="20" FontWeight="SemiBold" 
                                   Foreground="#0F172A" HorizontalAlignment="Center"/>
                        <TextBlock Text="I can help you with your shop management tasks. Ask me about products, orders, reports, or anything else!" 
                                   FontSize="14" Foreground="#64748B" TextAlignment="Center" TextWrapping="Wrap"/>
                        
                        <!-- Quick Actions -->
                        <TextBlock Text="Try asking:" FontSize="12" Foreground="#94A3B8" 
                                   Margin="0,8,0,0" HorizontalAlignment="Center"/>
                        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                            <Button Click="QuickPrompt_Click" Tag="What are my top selling products?"
                                    Background="#F1F5F9" BorderThickness="0" CornerRadius="16" Padding="12,8">
                                <TextBlock Text="ðŸ“¦ Top products" FontSize="12" Foreground="#475569"/>
                            </Button>
                            <Button Click="QuickPrompt_Click" Tag="How can I improve my sales?"
                                    Background="#F1F5F9" BorderThickness="0" CornerRadius="16" Padding="12,8">
                                <TextBlock Text="ðŸ“ˆ Improve sales" FontSize="12" Foreground="#475569"/>
                            </Button>
                            <Button Click="QuickPrompt_Click" Tag="Give me a daily report summary"
                                    Background="#F1F5F9" BorderThickness="0" CornerRadius="16" Padding="12,8">
                                <TextBlock Text="ðŸ“Š Daily report" FontSize="12" Foreground="#475569"/>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Input Area -->
        <Border Grid.Row="2" Background="White" Padding="24,16" 
                BorderBrush="#E2E8F0" BorderThickness="0,1,0,0">
            <Grid MaxWidth="900" HorizontalAlignment="Stretch">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Message Input -->
                <Border Grid.Column="0" Background="#F8FAFC" CornerRadius="12" 
                        BorderBrush="#E2E8F0" BorderThickness="1" Padding="4">
                    <TextBox x:Name="MessageInput" 
                             PlaceholderText="Type your message..." 
                             AcceptsReturn="True"
                             TextWrapping="Wrap"
                             MaxHeight="120"
                             BorderThickness="0" 
                             Background="Transparent"
                             Padding="12,10"
                             FontSize="14"
                             KeyDown="MessageInput_KeyDown"/>
                </Border>

                <!-- Send Button -->
                <Button x:Name="SendButton" Grid.Column="1" Click="SendMessage_Click"
                        Margin="12,0,0,0" Padding="16" CornerRadius="12"
                        VerticalAlignment="Bottom">
                    <Button.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#8B5CF6" Offset="0"/>
                            <GradientStop Color="#EC4899" Offset="1"/>
                        </LinearGradientBrush>
                    </Button.Background>
                    <FontIcon Glyph="&#xE724;" FontSize="18" Foreground="White"/>
                </Button>
            </Grid>
        </Border>

        <!-- Loading Overlay -->
        <Border x:Name="LoadingOverlay" Grid.RowSpan="3" Background="#80000000" 
                Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                <ProgressRing IsActive="True" Width="48" Height="48" Foreground="White"/>
                <TextBlock Text="AI is thinking..." FontSize="14" Foreground="White"/>
            </StackPanel>
        </Border>
    </Grid>
</Page>
